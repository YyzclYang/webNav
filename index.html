<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="./style.css">
  <title>简单导航</title>
</head>

<body>
  <header></header>
  <main>
    <div class="wrapper" id="nav"></div>
  </main>
  <footer></footer>
</body>
<script>
  //初始化数据
  var initData = init();
  var keys = initData['keys'];
  var hash = initData['hash'];
  //生成键盘，监听事件
  for (let index = 0; index < keys.length; index++) {
    Newdiv = document.createElement('div');
    nav.appendChild(Newdiv);
    var row = keys[index];

    for (var index2 = 0; index2 < row['length']; index2++) {
      var Newkey = createKey(row, index2);
      var Newbutton = createButton(row, index2);
      var Newspan = createSpan(hash, row, index2);
      var Newicon = createIcon(hash, row, index2);

      Newdiv.appendChild(Newkey);
      Newkey.appendChild(Newbutton);
      Newkey.appendChild(Newspan);
      Newkey.appendChild(Newicon);

      listenToUser(hash);//监听用户鼠标和键盘点击事件
    }
  }

  function init() {
    var keys = {
      0: { 0: '1', 1: '2', 2: '3', 3: '4', 4: '5', 5: '6', 6: '7', 7: '8', 8: '9', 9: '0', 'length': 10 },
      1: { 0: 'q', 1: 'w', 2: 'e', 3: 'r', 4: 't', 5: 'y', 6: 'u', 7: 'i', 8: 'o', 9: 'p', 'length': 10 },
      2: { 0: 'a', 1: 's', 2: 'd', 3: 'f', 4: 'g', 5: 'h', 6: 'j', 7: 'k', 8: 'l', 'length': 9 },
      3: { 0: 'z', 1: 'x', 2: 'c', 3: 'v', 4: 'b', 5: 'n', 6: 'm', 'length': 7 },
      'length': 4
    }
    var hash = {
      1: '163.com',
      2: 'github.com',
      3: 'developer.mozilla.org/zh-CN/',
      4: 'css-tricks.com',
      5: 'zhangxinxu.com/wordpress/category/css/page/25/',
      6: 'tympanus.net/codrops/category/playground/',
      7: 'ituring.com.cn/book/1695',
      8: 'http://cndevdocs.com/',
      9: 'adamschwartz.co/magic-of-css/',
      0: 'http://javascript.ruanyifeng.com/',
      q: 'qq.com',
      w: 'weibo.com',
      e: 'ele.me',
      r: 'renren.com',
      t: 'twitter.com',
      y: 'youtube.com',
      u: 'uc.cn',
      i: 'iqiyi.com',
      o: 'oschina.net',
      p: 'python.org',
      a: 'amazon.cn',
      s: 'sohu.com',
      d: 'douban.com',
      f: 'facebook.com',
      g: 'google.com',
      h: 'huya.com',
      j: 'jd.com',
      k: '',
      l: 'linux.org',
      z: 'zhihu.com',
      x: 'xunlei.com',
      c: 'cnki.net',
      v: 'v2ex.com',
      b: 'bilibili.com',
      n: 'nodejs.cn',
      m: 'imooc.com',
    }
    var hash_backup = JSON.parse(localStorage.getItem('hash_backup') || 'null')
    if (hash_backup) {
      hash = hash_backup
    }
    return {
      'keys': keys,
      'hash': hash
    }
  }




  function createKey(row, index2) {
    let Newkey = document.createElement('kbd');
    Newkey.textContent = row[index2];
    Newkey.className = 'key';
    Newkey.id = 'key';
    return Newkey;
  }

  function createButton(row, index2) {
    let Newbutton = document.createElement('button');
    Newbutton.textContent = 'E';
    Newbutton.id = row[index2];
    Newbutton.onclick = function (buttonclick) {
      let oldWebsite = hash[buttonclick.target.id];
      let newWebsite = prompt('请输入一个新网址', oldWebsite);
      if (newWebsite) {
        hash[buttonclick.target.id] = newWebsite;
      }
      localStorage.setItem('hash_backup', JSON.stringify(hash))
    }
    return Newbutton;
  }

  function createSpan(hash, row, index2) {
    let Newspan = document.createElement('span');
    Newspan.textContent = '点击前往 http://' + hash[row[index2]];
    return Newspan;
  }

  function createIcon(hash, row, index2) {
    let Newicon = document.createElement('img');
    if (hash[row[index2]]) {
      Newicon.src = 'http://' + hash[row[index2]] + '/favicon.ico';
    } else {
      Newicon.src = 'https://i.loli.net/2017/11/10/5a05afbc5e183.png'
    }
    return Newicon;
  }

  function listenToUser(hash) {
    Newkey.onclick = function (kbdclick) {
      let isKey = kbdclick.toElement.id;
      if (isKey == 'key') {
        let key = kbdclick.target.innerText;
        key = key.toLowerCase();
        let website = hash[key[0]];
        if (website) {
          window.open('http://' + website, '_blank');
        }
        else {
          alert('所选按钮网址为空，请点击编辑后输入');
        }
      }
    }

    document.onkeypress = function (keypress) {
      let website = hash[keypress.key];
      console.log(website)
      if (website) {
        window.open('http://' + website, '_blank');
      }
      else {
        alert('所选按钮网址为空，请点击编辑后输入');
      }
    }
  }

</script>

</html>